<html>

	<head>

	
	</head>

	<body>

		<P>Enter a github user:</P>
		<input type="text" id="user">
		<br>
		<br>
		<button onclick="checkUser()">Next</button>

		<p>Enter a phrase:</p>
		<input type="text" id="phrase">
		<br>
		
		<button onclick="getPhraseData()">Get data!</button>
		<br>
		
		<p id="data"></p>
		
		
		<script type="text/javascript">
			
			var userChecked = false;
			var user;
			var repos;
			var phrases = {};
			
			function checkUser() {
				
				document.getElementById("data").innerHTML = "Loading...";
				user = document.getElementById("user").value;
				var userUrl = ("https://api.github.com/users/" + user + "/repos");
				var userRequest = new XMLHttpRequest();
				userRequest.onload = verifyUser;
				userRequest.open("get", userUrl, true);
				userRequest.send();
				
				function verifyUser() {
					
					if (JSON.parse(this.responseText).message == "Not Found") {
						alert("No such Github user exists! Try again");
						document.getElementById("data").innerHTML = "";
						return;
					}
					
					repos = JSON.parse(this.responseText);
					document.getElementById("data").innerHTML = "";
					userChecked = true;
					
				}
				
			}
			
			function getPhraseData() {
				
				document.getElementById("data").innerHTML = "Loading...";
				var phrase = document.getElementById("phrase").value;
				if (phrase == "") {
					alert("Can't search for an empty phrase! Try again");
					document.getElementById("data").innerHTML = "";
					return;
				}
				
				phrases[phrase] = 0;
				
				for (var i = 0; i < repos.length; i++) {
					var repoUrl = repos[i].contents_url.replace("{+path}", "");
					var repoRequest = new XMLHttpRequest();
					repoRequest.onload = scanContents;
					repoRequest.open("get", repoUrl, true);
					repoRequest.send();
				}
				
				function scanContents() {
					
					var contents = JSON.parse(this.responseText);
					for (var i = 0; i < contents.length; i++) {
						var fileUrl = contents[i].download_url;
						var fileRequest = new XMLHttpRequest();
						fileRequest.onload = scanFile;
						fileRequest.open("get", fileUrl, true);
						fileRequest.send();
					}
					
					function scanFile() {
						
						phrases[phrase] += occurencesOfPatternInText(phrase, this.responseText);
						document.getElementById("data").innerHTML = "Number of occurences of '" + phrase + "' in " + user + "'s files: " + phrases[phrase];
						
					}
					
				}
				
			}
			
			function occurencesOfPatternInText(pattern, text) {
				
				var count = 0;
				var startOfPattern = text.search(pattern);
				while (startOfPattern != -1) {
					text = text.slice(startOfPattern + pattern.length);
					count++;
				}
				return count;
				
			}
			
			
		</script>

	</body>

</html>